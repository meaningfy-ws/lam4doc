{# Default way of showing errors #}
{% macro render_error(message) -%}
    <div class="ui icon message error">
        <i class="times circle icon"></i>
        <div class="content">
            <div class="header">
                Error
            </div>
            <p>{{ message|e }}</p>
        </div>
    </div>
{%- endmacro %}

{# Default macro for showing/wrapping the fetch results #}
{% macro render_fetch_results(content, error) -%}
    {% if error %}
        {{ render_error(error) }}
    {% else %}
        {% if content is undefined %}
            {{ render_error("Some content expected but none was found.") }}
        {% else %}
            {{ caller() }}
        {% endif %}
    {% endif %}
{%- endmacro %}


{% macro pandas_table(df, caption, column_labels={}) -%}
    {% if (df is defined) and (df is not none) %}
        <table class="display">
            <thead class="center aligned">
            <tr>
                {% for column in df.columns %}
                    {% if column in column_labels %}
                        <th>{{ column_labels[column] }}</th>
                    {% else %}
                        <th>{{ column }}</th>
                    {% endif %}
                {% endfor %}
            </tr>
            </thead>
            <tbody>
            {% for idx, row in df.iterrows() %}
                <tr>
                    {% for colname in df.columns %}
                        {# handle decimal format: float, float64, float32 #}
                        {% if 'float' in (df.dtypes[colname] | string) %}
                            <td class="left aligned collapsing">{{ row[colname] | round(precision=2) }}</td>
                        {% else %}
                            <td>{{ row[colname] }}</td>
                        {% endif %}
                    {% endfor %}
                </tr>
            {% endfor %}
            </tbody>
            <caption>{{ caption }}</caption>
        </table>
    {% else %}
        {{ render_error("How did you get here? did you forget to use 'render_fetch_results' macro?") }}
    {% endif %}
{%- endmacro %}

{% macro render_description_item_plain_literal(result_set, property_id, property_label) -%}
    <p class="debug-render">render_description_item_plain_literal: {{ property_id }}</p>
    {% if not result_set.empty and property_id in result_set.columns %}
        {% set values =  result_set[property_id].dropna() %}
        {% if not values.empty %}
            <dl>
                <dt title="{{ property_id }}">{{ property_label }}</dt>
                {% for idx, item in values.iteritems() %}
                    <dd title="{{ property_id }}">{{ item|e|replace("\n","<br/>") }}</dd>
                {% endfor %}
            </dl>
        {% endif %}
    {% else %}
        {{ render_error("Either the result set is empty or the property id "~property_id~" doesn't exist") }}
    {% endif %}
{%- endmacro %}


{% macro render_description_item_local_iri(result_set, property_id, property_label, link_label_property_id=None) -%}
    <p class="debug-render">render_description_item_local_iri: {{ property_id }}</p>

    {% if not result_set.empty and property_id in result_set.columns %}
        {% set values =  result_set[property_id].dropna() %}
        {% if not values.empty %}
            <dl>
                <dt>{{ property_label }}</dt>
                {% for idx, item in values.iteritems() %}
                    {% if link_label_property_id is none %}
                        <dd><a href="#{{ item }}">{{ item|e|replace("\n","<br/>") }}</a></dd>
                    {% else %}
                        <dd><a href="#{{ item }}">{{ link_label_property_id }}</a></dd>
                    {% endif %}
                {% endfor %}
            </dl>
        {% endif %}
    {% else %}
        {{ render_error("Either the result set is empty or the property id "~property_id~" doesn't exist") }}
    {% endif %}
{%- endmacro %}
